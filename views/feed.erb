<!-- feed.erb -->

<!-- –ó–∞–∫—Ä—ñ–ø–ª–µ–Ω–∞ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è -->
<nav class="navbar is-light" role="navigation" aria-label="main navigation" style="position: sticky; top: 0; z-index: 100; background: white;">
  <div class="navbar-menu is-active">
    <div class="navbar-start">
      <a href="/profile" class="navbar-item">‚¨Ö –ù–∞–∑–∞–¥ –¥–æ –ø—Ä–æ—Ñ—ñ–ª—é</a>
      <a href="/users" class="navbar-item">–Ü–Ω—à—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ</a>
    </div>
  </div>
</nav>

<section class="section">
  <div class="container">
    <h2 class="title is-4">üì∞ –°—Ç—Ä—ñ—á–∫–∞ –Ω–æ–≤–∏–Ω</h2>

    <% @messages.each do |msg| %>
      <div class="box">
        <p><strong><%= msg.user.username %>:</strong> <%= msg.content %></p>

        <% if msg.image %>
          <figure class="mt-2 mb-2">
            <img src="<%= msg.image %>" style="max-width: 400px; width: 100%; height: auto;">
          </figure>
        <% end %>


        <small><%= msg.created_at.strftime("%Y-%m-%d %H:%M") %></small><br>

        <div class="mt-2">
          <% if current_user.likes.exists?(message_id: msg.id) %>
            <form action="/messages/<%= msg.id %>/unlike" method="post" style="display:inline;">
              <button class="button is-danger is-small" type="submit">üíî –°–∫–∞—Å—É–≤–∞—Ç–∏ –≤–ø–æ–¥–æ–±–∞–Ω–Ω—è</button>
            </form>
          <% else %>
            <form action="/messages/<%= msg.id %>/like" method="post" style="display:inline;">
              <button class="button is-primary is-small" type="submit">‚ù§Ô∏è –í–ø–æ–¥–æ–±–∞—Ç–∏</button>
            </form>
          <% end %>

          <span class="ml-2">–õ–∞–π–∫—ñ–≤: <%= msg.likes.count %></span>
        </div>

        <hr>

        <h4 class="subtitle is-6">–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ:</h4>
        <% msg.comments.each do |c| %>
          <p><strong><%= c.user.username %>:</strong> <%= c.content %></p>
        <% end %>

        <form action="/messages/<%= msg.id %>/comments" method="post" class="mt-2">
          <div class="field has-addons">
            <div class="control is-expanded">
              <input class="input" type="text" name="content" placeholder="–ó–∞–ª–∏—à–∏—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä..." required>
            </div>
            <div class="control">
              <button class="button is-info" type="submit">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
            </div>
          </div>
        </form>
      </div>
    <% end %>
  </div>
</section>
